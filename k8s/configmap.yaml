# ConfigMap: nicht-sensible Umgebungsvariablen
# Entspricht .env.example – optionale Variablen unten auskommentiert
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: fastflow-config
  labels:
    app: fastflow-orchestrator
data:
  # Umgebungsmodus (development | production)
  # Dev: Beispiel-Pipelines werden bei leerem Verzeichnis kopiert. Prod: nur Git-Sync.
  ENVIRONMENT: "development"
  # Host-Pfad für Pipelines: Node-Pfad des PVC (Worker müssen von dort mounten)
  # Ermitteln: kubectl exec deploy/fastflow-orchestrator -c orchestrator -- grep pipelines /proc/self/mountinfo | head -1
  # Pfad setzen, dann rollout restart. Ohne Setzen funktionieren Pipeline-Runs nicht.
  # PIPELINES_HOST_DIR: "/var/lib/kubelet/pods/..."
  # BASE_URL / FRONTEND_URL: Bei Minikube-VM setzt scripts/minikube-vm.sh die Minikube-IP automatisch.
  # Sonst: NodePort 30080 → http://<K8s-Node-IP>:30080 oder Port-Forward 8000.
  BASE_URL: "http://localhost:8000"
  FRONTEND_URL: "http://localhost:8000"

  # Logging
  LOG_LEVEL: "INFO"
  # LOG_JSON: "false"   # In Produktion oft true für ELK/Datadog

  # Pipeline-Discovery-Cache (Sekunden)
  PIPELINE_CACHE_TTL_SECONDS: "60"

  # Langsame Requests (Sekunden) – darüber wird WARNING geloggt
  # SLOW_REQUEST_THRESHOLD_SECONDS: "5.0"
  # MAX_REQUEST_BODY_MB: "10"

  # Docker & UV. Lokales Testen: scripts/minikube-vm.sh patcht auf fastflow-worker:latest.
  # Ohne Script: für lokales Image hier "fastflow-worker:latest" eintragen (nach Build + minikube docker-env).
  WORKER_BASE_IMAGE: "fastflow-worker:latest"
  DEFAULT_PYTHON_VERSION: "3.11"
  # UV_PRE_HEAT: "true"

  # Concurrency & Timeouts
  MAX_CONCURRENT_RUNS: "10"
  # CONTAINER_TIMEOUT: ""
  # RETRY_ATTEMPTS: "0"

  # Kubernetes (PIPELINE_EXECUTOR=kubernetes): KUBERNETES_NAMESPACE etc. werden im Deployment gesetzt
  # Abgeschlossene Pipeline-Jobs (succeeded/failed) nach N Sekunden automatisch löschen. 0 = nicht löschen.
  KUBERNETES_JOB_TTL_SECONDS_AFTER_FINISHED: "300"

  # Git-Sync: Repository-URL (nicht sensibel). Token in secrets.yaml.
  # Kann auch in der Sync-UI unter "Repository" gesetzt werden.
  # GIT_REPO_URL: "https://github.com/org/pipeline-repo.git"
  # GIT_BRANCH: "main"
  # AUTO_SYNC_ENABLED: "false"
  # AUTO_SYNC_INTERVAL: ""

  # Log-Management
  # LOG_RETENTION_RUNS: ""
  # LOG_RETENTION_DAYS: ""
  # LOG_MAX_SIZE_MB: ""
  # LOG_STREAM_RATE_LIMIT: "100"

  # Log-Backup (S3/MinIO) – nicht-sensible Teile
  # S3_BACKUP_ENABLED: "false"
  # S3_ENDPOINT_URL: "http://minio:9000"
  # S3_BUCKET: "fastflow-logs"
  # S3_REGION: "us-east-1"
  # S3_PREFIX: "pipeline-logs"
  # S3_USE_PATH_STYLE: "true"

  # JWT (nicht-sensible Teile)
  # JWT_ALGORITHM: "HS256"
  # JWT_ACCESS_TOKEN_MINUTES: "15"
  # JWT_EXPIRATION_HOURS: "24"

  # Proxy & CORS
  # PROXY_HEADERS_TRUSTED: "false"
  # CORS_ORIGINS: "https://yourdomain.com"

  # OAuth – CLIENT_IDs (Secrets in secrets.yaml)
  # INITIAL_ADMIN_EMAIL: "admin@example.com"

  # Custom OAuth (Keycloak, Auth0)
  # CUSTOM_OAUTH_AUTHORIZE_URL: "https://..."
  # CUSTOM_OAUTH_TOKEN_URL: "https://..."
  # CUSTOM_OAUTH_USERINFO_URL: "https://..."
  # CUSTOM_OAUTH_SCOPES: "openid email profile"
  # CUSTOM_OAUTH_CLAIM_ID: "sub"
  # CUSTOM_OAUTH_CLAIM_EMAIL: "email"
  # CUSTOM_OAUTH_CLAIM_NAME: "name"
  # CUSTOM_OAUTH_NAME: "Custom"

  # E-Mail-Benachrichtigungen (nicht-sensible Teile)
  # EMAIL_ENABLED: "false"
  # SMTP_HOST: "smtp.example.com"
  # SMTP_PORT: "587"
  # SMTP_USER: "user@example.com"
  # SMTP_FROM: "noreply@example.com"
  # EMAIL_RECIPIENTS: "admin@example.com"

  # Microsoft Teams
  # TEAMS_ENABLED: "false"

